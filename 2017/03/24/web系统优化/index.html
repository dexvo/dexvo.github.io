<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="最美好的事,是看到某人的微笑;更美好的事,是TA因你而微笑."><title>web系统优化 | Dexvo</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/5.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/main.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">web系统优化</h1><a id="logo" href="/.">Dexvo</a><p class="description">Dexvo的博客</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">web系统优化</h1><div class="post-meta">Mar 24, 2017<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><h1 id="容错机制"><a href="#容错机制" class="headerlink" title="容错机制"></a>容错机制</h1><h2 id="重试机制"><a href="#重试机制" class="headerlink" title="重试机制"></a>重试机制</h2><h3 id="主备服务的重试和切换"><a href="#主备服务的重试和切换" class="headerlink" title="主备服务的重试和切换."></a>主备服务的重试和切换.</h3><p><strong>简单重试缺陷:</strong> 简单的重试会带来双倍的流量, 冲击服务系统,而在真实的业务场景中,一个功能不可用,<br>往往更容易引起用户的”反复点击”,反而制造更大规模的流量冲击。<br><strong>主备重试缺陷:</strong></p>
<ol>
<li>资源浪费, 备份服务器长期处于闲置状态.但对于核心的业务(核心数据,营收相关)可以这样部署. </li>
<li>触发重试机制,对于用户请求来说,耗时增加,严重影响用户体验. </li>
<li>主备服务一起陷入异常. 如果是因为流量过大导致主服务异常,备份服务很可能也会承受不住而挂掉.<h3 id="动态剔除或者恢复异常机器"><a href="#动态剔除或者恢复异常机器" class="headerlink" title="动态剔除或者恢复异常机器."></a>动态剔除或者恢复异常机器.</h3><strong>优点:</strong></li>
<li>所有服务与存储,无状态路由. 避免单点风险.后端的服务,通常都一一组机器的形式提供服务, 彼此之间没有状态关系,支撑随机分配请求.</li>
<li>支持平行扩容. 遇到大流量场景,支持加机器扩容.</li>
<li>自动剔除和恢复异常机器. 路由服务发现某个服务异常的时候(成功率低于50%),就会自动剔除该机器. 后续,发出试探性请求,确认机器恢复<br>正常后,重新加回到服务机器组.<h2 id="超时时间"><a href="#超时时间" class="headerlink" title="超时时间"></a>超时时间</h2><h3 id="为服务和存储设置合理的超时时间"><a href="#为服务和存储设置合理的超时时间" class="headerlink" title="为服务和存储设置合理的超时时间"></a>为服务和存储设置合理的超时时间</h3> 超时时间设置过长会导致网络或服务异常时耗尽系统资源(所有的worker都在等待),导致新的请求无worker可用,只能陷入异常情况.<br> 超时时间设置过短会引起服务的成功率下降.<ol>
<li>超时时间过短引起的服务成功率下降.对于全部业务,以一刀切的方式设置一个超时时间,是比较不可取的.<br><strong>优化方案有两种:</strong><ul>
<li>快慢分离, 根据实际的业务维度,区分对待地给各个业务服务配置不同的超时时间.</li>
<li>解决同步阻塞等待, 对于某些耗时本来就比较长的服务而言，系统的进程线程资源仍然在同步等待过程中，<br>无法响应其他新的请求，只能阻塞等待，它的资源仍然是被占据，系统的整体吞吐率仍然被大幅度拉低。<br>解决的思路，当然是利用I/O多路复用，通过异步回调的方式，解决同步等待过程中的资源浪费。<br>AMS的一些核心服务，采用的就是“协程”（又叫“微线程”，简单的说，常规异步程序代码里嵌套比较多层的函数回调，编写复杂。<br>而协程则提供了一种类似写同步代码的方式，来写异步回调程序），以解决同步等待的问题。异步处理的简单描述，<br>就是当进程遇到I/O网络阻塞时，就保留现场，立刻切换去处理下一个业务请求，进程不会因为某个网络等待而停止处理业务，<br>进而，系统吞吐率即使遇到网络等待时间过长的场景，通常都能保持在比较高的水平.异步处理只是解决系统的吞吐率问题，<br>对于用户的体验问题，并不会有改善，用户需要等待的时间并不会减少.</li>
</ul>
</li>
<li>防重入, 防止重复发货     </li>
</ol>
</li>
</ol>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://yoursite.com/2017/03/24/web系统优化/" data-id="cj1dmdjom000bggs66ckpt16s" class="article-share-link">分享到</a><div class="tags"></div><div class="post-nav"><a href="/2017/03/24/intellij-skill/" class="pre">Intellij idea使用技巧</a><a href="/2016/12/28/day-note/" class="next">Daily Notes</a></div></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="search" name="word" maxlength="20" placeholder="Search"/><input type="hidden" name="si" value="http://yoursite.com"/><input name="tn" type="hidden" value="bds"/><input name="cl" type="hidden" value="3"/><input name="ct" type="hidden" value="2097152"/><input name="s" type="hidden" value="on"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/04/10/2017规划/">2017规划</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/10/经典语录摘抄/">经典语录摘抄</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/06/web.xml详解/">web.xml详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/30/循环节长度/">循环节长度</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/30/字符串算法一/">字符串算法一</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/30/网易云音乐热门评论/">网易云音乐热门评论摘抄</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/24/intellij-skill/">Intellij idea使用技巧</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/24/web系统优化/">web系统优化</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/28/day-note/">Daily Notes</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/23/spoken-english/">spoken english</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.matrix67.com/blog/" title="matrix67" target="_blank">matrix67</a><ul></ul><a href="http://wjmzbmr.com/" title="陈立杰" target="_blank">陈立杰</a><ul></ul><a href="http://rednaxelafx.iteye.com/" title="RednaxelaFx" target="_blank">RednaxelaFx</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">Dexvo.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>